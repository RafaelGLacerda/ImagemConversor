<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="logo.png" type="image/png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7-Conversor de Imagens (PNG ↔ JPG ↔ WebP)</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* --- CSS Reset & Base --- */
        :root {
            /* Light Mode Defaults */
            --bg-color: #f0f2f5;
            --card-bg-color: #ffffff;
            --text-color: #333333;
            --heading-color: #2c3e50;
            --primary-color: #007bff;
            --primary-hover-color: #0056b3;
            --secondary-color: #6c757d;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --input-bg-color: #f8f9fa;
            --input-border-color: #ced4da;
            --button-success-bg: #28a745;
            --button-success-hover: #218838;
            --message-bg-info: #e2f0fb;
            --message-border-info: #b3dcf1;
            --message-text-info: #0c5460;
            --toggle-bg-color: #ccc;
            --toggle-circle-color: #fff;
            --toggle-bg-active: #007bff; /* Color when dark mode is on */
        }

        [data-theme='dark'] {
            --bg-color: #1a1a2e;
            --card-bg-color: #16213e;
            --text-color: #e0e0e0;
            --heading-color: #ffffff;
            --primary-color: #8be9fd; /* Lighter primary for dark mode */
            --primary-hover-color: #61dafb;
            --secondary-color: #b0bec5;
            --border-color: #3f4e6e;
            --shadow-color: rgba(0, 0, 0, 0.4);
            --input-bg-color: #2e3b5e;
            --input-border-color: #4e5f8b;
            --button-success-bg: #4caf50; /* Slightly adjusted for dark mode */
            --button-success-hover: #43a047;
            --message-bg-info: #2a3a5e;
            --message-border-info: #4e5f8b;
            --message-text-info: #a7d9ff;
            --toggle-bg-color: #555;
            --toggle-circle-color: #e0e0e0;
            --toggle-bg-active: #8be9fd; /* Toggle switch color when dark mode is off (showing light) */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            background-color: var(--card-bg-color);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 25px var(--shadow-color);
            width: 100%;
            max-width: 650px;
            margin: 30px 20px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        h1 {
            color: var(--heading-color);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        /* --- Theme Toggle Switch --- */
        .theme-switch-wrapper {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 20px;
        }
        .theme-switch {
            display: inline-block;
            height: 28px;
            position: relative;
            width: 50px;
        }
        .theme-switch input {
            display: none;
        }
        .slider {
            background-color: var(--toggle-bg-color);
            bottom: 0;
            cursor: pointer;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            background-color: var(--toggle-circle-color);
            bottom: 4px;
            content: "";
            height: 20px;
            left: 4px;
            position: absolute;
            width: 20px;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        .theme-switch-wrapper span {
            margin-right: 10px;
            font-size: 0.9em;
            color: var(--text-color);
        }

        /* --- Form Elements --- */
        input[type="file"] {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 6px;
            border: 1px solid var(--input-border-color);
            background-color: var(--input-bg-color);
            color: var(--text-color);
            font-size: 16px;
            cursor: pointer;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        input[type="file"]:hover {
            border-color: var(--primary-color);
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--input-bg-color);
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 400;
            color: var(--text-color);
        }
        input[type="number"], select, input[type="range"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--input-border-color);
            border-radius: 6px;
            background-color: var(--card-bg-color);
            color: var(--text-color);
            font-size: 16px;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        input[type="number"]:focus, select:focus, input[type="range"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        .range-value {
            font-weight: 600;
            margin-left: 8px;
            color: var(--primary-color);
        }

        button {
            width: 100%;
            padding: 15px;
            background-color: var(--button-success-bg);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        button:hover:not(:disabled) {
            background-color: var(--button-success-hover);
            transform: translateY(-2px);
        }
        button:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .message {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--message-bg-info);
            border: 1px solid var(--message-border-info);
            color: var(--message-text-info);
            border-radius: 8px;
            display: none;
            text-align: center;
            font-size: 0.95em;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        /* --- Image Previews --- */
        #previewContainer {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            transition: border-color 0.3s ease;
        }
        #previewContainer h2 {
            color: var(--heading-color);
            margin-bottom: 20px;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        #previewContainer p {
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: 400;
            color: var(--text-color);
        }
        .image-preview {
            max-width: 100%;
            height: auto;
            border: 2px dashed var(--input-border-color);
            margin-top: 15px;
            padding: 5px; /* Adiciona um padding para a borda ficar mais visível */
            border-radius: 8px;
            display: none;
            object-fit: contain; /* Garante que a imagem se ajuste sem cortar */
            background-color: var(--input-bg-color); /* Fundo para quando não há imagem */
            min-height: 100px; /* Altura mínima para o box de preview */
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            color: var(--secondary-color);
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        .image-preview img {
            max-width: 100%;
            max-height: 300px; /* Limita a altura das previews */
            display: block; /* Remove espaço extra abaixo da imagem */
            margin: 0 auto;
        }
        .image-preview.has-image {
            display: block; /* Exibe o bloco de preview quando tem imagem */
        }
        .image-preview.has-image::before {
            content: none; /* Remove o texto "Nenhuma imagem" quando tem imagem */
        }

        /* Placeholder text for image previews */
        #originalImageContainer::before, #outputImageContainer::before {
            content: "Nenhuma imagem selecionada";
            display: block;
            text-align: center;
            color: var(--secondary-color);
            font-style: italic;
            line-height: 100px; /* Centraliza o texto verticalmente */
        }
        #originalImageContainer.has-image::before, #outputImageContainer.has-image::before {
            content: none;
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .container {
                padding: 25px;
                margin: 20px 15px;
            }
            h1 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }
            .controls {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            button {
                font-size: 16px;
                padding: 12px;
            }
            .theme-switch-wrapper {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body data-theme="light">

    <div class="container">
        <div class="theme-switch-wrapper">
            <span>Modo Escuro</span>
            <label class="theme-switch" for="checkbox">
                <input type="checkbox" id="checkbox" />
                <div class="slider round"></div>
            </label>
        </div>

        <h1>Converta suas Imagens</h1>
        
        <input type="file" id="imageInput" accept="image/*">

        <div class="controls">
            <div class="control-group">
                <label for="outputFormat">Formato de Saída:</label>
                <select id="outputFormat">
                    <option value="image/png">PNG</option>
                    <option value="image/jpeg">JPG</option>
                    <option value="image/webp">WebP</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="quality">Qualidade (JPG/WebP): <span id="qualityValue" class="range-value">90</span></label>
                <input type="range" id="quality" min="10" max="100" value="90">
            </div>

            <div class="control-group">
                <label for="width">Nova Largura (px):</label>
                <input type="number" id="width" placeholder="Original">
            </div>

            <div class="control-group">
                <label for="height">Nova Altura (px):</label>
                <input type="number" id="height" placeholder="Original">
            </div>
        </div>

        <button id="convertButton" disabled>Converter e Baixar Imagem</button>

        <p class="message" id="statusMessage">Aguardando arquivo...</p>
        
        <div id="previewContainer">
            <h2>Pré-visualização</h2>
            <p>Original:</p>
            <div class="image-preview" id="originalImageContainer">
                <img id="originalImage" alt="Imagem Original">
            </div>
            <p>Convertida:</p>
            <div class="image-preview" id="outputImageContainer">
                <img id="outputImage" alt="Imagem Convertida">
            </div>
        </div>
    </div>

    <script>
        // --- JavaScript ---
        const imageInput = document.getElementById('imageInput');
        const outputFormat = document.getElementById('outputFormat');
        const qualityInput = document.getElementById('quality');
        const qualityValueSpan = document.getElementById('qualityValue');
        const widthInput = document.getElementById('width');
        const heightInput = document.getElementById('height');
        const convertButton = document.getElementById('convertButton');
        const originalImageElement = document.getElementById('originalImage');
        const outputImageElement = document.getElementById('outputImage');
        const originalImageContainer = document.getElementById('originalImageContainer');
        const outputImageContainer = document.getElementById('outputImageContainer');
        const statusMessage = document.getElementById('statusMessage');

        let originalFile = null;
        let originalWidth = 0;
        let originalHeight = 0;

        // --- Theme Toggle Logic ---
        const themeToggle = document.getElementById('checkbox');
        const body = document.body;

        // Load theme preference from localStorage
        const currentTheme = localStorage.getItem('theme');
        if (currentTheme) {
            body.setAttribute('data-theme', currentTheme);
            if (currentTheme === 'dark') {
                themeToggle.checked = true;
            }
        }

        themeToggle.addEventListener('change', function() {
            if (this.checked) {
                body.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                body.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }
        });

        // Atualiza o valor do range de Qualidade
        qualityInput.addEventListener('input', () => {
            qualityValueSpan.textContent = qualityInput.value;
        });

        // Habilita/Desabilita o botão e carrega a imagem original
        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                originalFile = file;
                convertButton.disabled = false;
                statusMessage.style.display = 'none';

                const reader = new FileReader();
                reader.onload = (e) => {
                    originalImageElement.src = e.target.result;
                    originalImageContainer.classList.add('has-image');
                    outputImageContainer.classList.remove('has-image'); // Limpa a saída anterior
                    outputImageElement.src = ''; // Limpa a imagem de saída
                    
                    const img = new Image();
                    img.onload = () => {
                        originalWidth = img.width;
                        originalHeight = img.height;
                        widthInput.placeholder = `Original: ${originalWidth}px`;
                        heightInput.placeholder = `Original: ${originalHeight}px`;
                        // Resetar os campos de tamanho para os placeholders
                        widthInput.value = ''; 
                        heightInput.value = '';
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                convertButton.disabled = true;
                originalImageElement.src = '';
                outputImageElement.src = '';
                originalImageContainer.classList.remove('has-image');
                outputImageContainer.classList.remove('has-image');
                statusMessage.textContent = 'Por favor, selecione um arquivo de imagem válido.';
                statusMessage.style.display = 'block';
                widthInput.placeholder = 'Original';
                heightInput.placeholder = 'Original';
                widthInput.value = '';
                heightInput.value = '';
            }
        });

        // Evento de conversão
        convertButton.addEventListener('click', () => {
            if (!originalFile) {
                statusMessage.textContent = 'Por favor, carregue uma imagem primeiro.';
                statusMessage.style.display = 'block';
                return;
            }

            statusMessage.textContent = 'Processando...';
            statusMessage.style.display = 'block';
            convertButton.disabled = true;

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    try {
                        const targetFormat = outputFormat.value;
                        const quality = parseInt(qualityInput.value) / 100; 

                        let newWidth = parseInt(widthInput.value);
                        let newHeight = parseInt(heightInput.value);

                        // Lógica para manter a proporção
                        if (isNaN(newWidth) && isNaN(newHeight)) { // Ambos vazios, usa original
                            newWidth = originalWidth;
                            newHeight = originalHeight;
                        } else if (isNaN(newWidth)) { // Largura vazia, calcula com base na altura
                            newWidth = (originalWidth / originalHeight) * newHeight;
                        } else if (isNaN(newHeight)) { // Altura vazia, calcula com base na largura
                            newHeight = (originalHeight / originalWidth) * newWidth;
                        }
                        
                        newWidth = Math.round(newWidth);
                        newHeight = Math.round(newHeight);

                        const canvas = document.createElement('canvas');
                        canvas.width = newWidth;
                        canvas.height = newHeight;
                        const ctx = canvas.getContext('2d');
                        
                        ctx.drawImage(img, 0, 0, newWidth, newHeight);

                        const outputDataUrl = canvas.toDataURL(targetFormat, quality);
                        
                        outputImageElement.src = outputDataUrl;
                        outputImageContainer.classList.add('has-image');

                        const downloadLink = document.createElement('a');
                        const ext = targetFormat.split('/')[1].replace('jpeg', 'jpg'); 
                        downloadLink.download = `convertido_${Date.now()}.${ext}`;
                        downloadLink.href = outputDataUrl;
                        
                        downloadLink.click();

                        statusMessage.textContent = `Conversão para ${ext.toUpperCase()} concluída e download iniciado.`;
                        convertButton.disabled = false;

                    } catch (error) {
                        statusMessage.textContent = `Erro durante a conversão: ${error.message}`;
                        console.error('Erro de conversão:', error);
                        convertButton.disabled = false;
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(originalFile);
        });
    </script>
</body>
</html>